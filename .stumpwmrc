(in-package :stumpwm)

;; TODO

;; Untag
;; allow multiple tags: "mail, emacs, browser" etc


;; Custom key bindings

(define-key *root-map* (kbd "`")
  "exec rxvt +sb -fn terminus-16 -bg white -e screen -xRR")


;; Custom functions

(defun current-window ()
  (screen-current-window (current-screen)))

;; Tagging windows

(defun show-tag (tag screen)
  (mapcar #'(lambda (window)
	      (if (and (not (tagged window tag))
			(xlib:window-p window))
		  (hide-window window)
		  (unhide-window window)))
   (screen-mapped-windows screen)))

(defun window-tags (window)
  (gethash :tags (gethash window (screen-window-hash (window-screen window)))))

(defun tagged (window tag)
  (find tag (window-tags window) :test 'equal))

(defun tag (window tag)
  (setf (gethash :tags (gethash window (screen-window-hash (window-screen window))))
	(if (tagged window tag)
	    () ; already tagged
	  (append (list tag) (window-tags window)))))


;; Defining commands

(define-stumpwm-command "tag-window" (screen (tag :rest "Tag: "))
  (tag (screen-current-window screen) tag))

(define-stumpwm-command "show-tag" (screen (tag :rest "Show Tag: "))
  (show-tag tag screen))

(define-stumpwm-command "windows-tags" (screen)
  (window-tags (screen-current-window screen)))

(define-key *root-map* (kbd "g") "tag-window")
(define-key *root-map* (kbd "C-g") "show-tag")
(define-key *root-map* (kbd "C-d") "windows-tags")


